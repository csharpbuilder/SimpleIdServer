@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using FormBuilder.Helpers
@using Microsoft.Extensions.Options
@using FormBuilder.Components
@using FormBuilder.Components.Workflow
@using FormBuilder
@using Microsoft.AspNetCore.Http;
@inject IOptions<FormBuilderOptions> options
@inject IHttpContextAccessor HttpContextAccessor;
@inject IUriProvider uriProvider
@model FormBuilder.UIs.WorkflowViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var antiforgeryToken = HttpContextAccessor.HttpContext.Request.Cookies[options.Value.AntiforgeryCookieName];
    Model.AntiforgeryToken.CookieValue = antiforgeryToken;
    var step = Model.Workflow.Steps.Single(s => s.Id == Model.CurrentStepId);
    var path = uriProvider.GetActiveLastFormCssUrl(step.FormRecordCorrelationId);
}

<component type="typeof(WorkflowViewer)" 
    render-mode="ServerPrerendered" 
    param-FormRecords="@Model.FormRecords"
    param-Workflow="@Model.Workflow"
    param-Input="@Model.Input"
    param-AntiforgeryToken="@Model.AntiforgeryToken"
    param-CurrentStepId="@Model.CurrentStepId" 
    param-ErrorMessages="@Model.ErrorMessages" 
    param-SuccessMessages="@Model.SuccessMessages" />

@section Header {
    <link rel="stylesheet" href="@path" />
}