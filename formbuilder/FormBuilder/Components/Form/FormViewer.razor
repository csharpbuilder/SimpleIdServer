@using FormBuilder.Helpers
@using System.Text.Json.Nodes
@using FormBuilder.Rules
@using global::FormBuilder.Models
@inject IRenderFormElementsHelper renderFormsElementsHelper

@if(Form.Elements != null)
{
    @CustomRender
}

@code {
    private RenderFragment? CustomRender { get; set; }
    [Inject] public IRuleEngine RuleEngine { get; set; }
    [Parameter] public FormRecord Form { get; set; }
    [Parameter] public JsonObject Input { get; set; }
    [Parameter] public bool IsEditModeEnabled { get; set; }
    [Parameter] public FormViewerContext Context { get; set; }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        RuleEngine.Apply(Form, Input);
        CustomRender = CreateComponent();
    }

    private RenderFragment CreateComponent() => builder =>
    {
        renderFormsElementsHelper.Render(builder, Form.Elements, Context, IsEditModeEnabled);
    };
}